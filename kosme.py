import openai
import os
from getpass import getpass

# 현재 경로를 기준으로 input.txt 파일 경로 설정
file_path = os.path.join(os.path.dirname(__file__), 'input.txt')

# input.txt에서 API 키 읽어오기
with open(file_path, 'r', encoding='utf-8') as file:
    MY_API_KEY = file.readline().strip()

# OpenAI API 클라이언트 초기화
openai.api_key = MY_API_KEY

def get_business_plan_data(inputs):
    """
    사용자가 입력한 데이터를 기반으로 사업계획서 관련 데이터를 반환하는 함수.
    """
    # 아이템 정보 (사용자 입력을 기반으로 설정)
    item_info = {
        '아이템명': inputs['아이템 명'],
        '아이템 소개': inputs['아이템 소개'],
        '제품 및 서비스 개발동기': f"{inputs['아이템 명']}의 시장 성장과 사용자 편의성 향상",
        '제품 및 서비스의 목적_필요성': f"{inputs['아이템 명']}은 고객의 니즈를 혁신적으로 해결하려는 필요성",
        '제품 및 서비스의 개발 방안': "AI 알고리즘을 기반으로 시스템을 개발",
        '자금 조달 및 개발 방안': "정부 지원금 및 민간 투자금을 통해 초기 자금을 확보",
        '내수시장 확보 방안 경쟁 및 판매가능성': f"{inputs['아이템 명']}은 기존 기기와의 연계성 제공",
        '해외시장 진출 방안 경쟁 및 판매가능성': f"{inputs['아이템 명']}은 해외 시장 진출을 목표",
        '대표자 및 직원의 보유역량 및 기술보호 노력': "스마트 홈 관련 경험과 기술을 보유",
        '사회적 가치 실천계획': "지속 가능한 기술 개발과 양질의 일자리 창출",
        '지역특화 아이디어 기반 사업추진계획': "지역 특성에 맞게 스마트 홈 기술 최적화",
        '타겟 고객': "30대 이상 스마트 기기에 관심이 있는 중산층 이상 가구",
        '시장 규모': "스마트 홈 시장은 매년 10% 성장하고 있으며, 2025년까지 500억 달러 예상",
        '경쟁사 분석': "구글, 아마존 등의 경쟁사와 차별화된 사용자 경험 제공"
    }

    # 프롬프트들 생성
    prompt_1 = f"""
    당신은 기존 창업가의 아이디어를 구체화하고 사업 가능성을 검증하는 사업계획서 작성 전문가입니다. 
    아래 항목에 대해 각각 15줄 이상 상세히 답변해주세요. 반드시 답변마다 별도의 문단을 생성하고, 간결함보다 완전성을 우선시합니다.
    이 사업계획서는 내 생계가 달린 아주 중요한 작업입니다.
    다음 정보를 바탕으로 아이디어 검증 및 사업 구체화를 위한 사업계획서에서 제품 및 서비스 개발동기와 서비스의 목적&필요성 부분만 작성해 주세요.
    시장의 필요성과 법제화가 중요합니다.
    관련된 정보를 더 찾아서 사업아이템을 구체화해줘도 좋습니다.
    
    문제 인식 1: {item_info['제품 및 서비스 개발동기']}
    문제 인식 2: {item_info['제품 및 서비스의 목적_필요성']}
    
    **반드시 지켜야 할 출력 규칙**
    1. 절대 #, *, - 기호 및 마크다운 스타일 절대 금지
    2. 항목 표시 시 "1)", "2)" 형식만 사용 (숫자+닫는 괄호)
    3. 데이터 출처 명시 : 모든 통계 수치에 출처를 포함
    예시 출력:  
    1. 문제인식
    1) 제품 및 서비스 개발동기  
    본 제품은 시장의 OOO한 문제를 해결하기 위해 개발되었습니다...  
    2) 제품 및 서비스의 목적 및 필요성  
    현재 시장에서 유사 제품은 OOO한 한계를 가지고 있으며...  
    """

    prompt_2 = f"""
    당신은 기존 창업가의 아이디어를 구체화하고 사업 가능성을 검증하는 사업계획서 작성 전문가입니다. 
    아래 항목에 대해 각각 15줄 이상 상세히 답변해주세요. 반드시 답변마다 별도의 문단을 생성하고, 간결함보다 완전성을 우선시합니다.
    이 사업계획서는 내 생계가 달린 아주 중요한 작업입니다.
    다음 정보를 바탕으로 아이디어 검증 및 사업 구체화를 위한 사업계획서에서 제품 및 서비스의 개발 방안 부분만 작성해 주세요.
    
    실현 가능성 1: {item_info['제품 및 서비스의 개발 방안']}
    **반드시 지켜야 할 출력 규칙**
    1. 절대 #, *, - 기호 및 마크다운 스타일 절대 금지
    2. 항목 표시 시 "1)", "2)" 형식만 사용 (숫자+닫는 괄호)
    3. 데이터 출처 명시 : 모든 통계 수치에 출처를 포함
    예시 출력: 
    2. 실현 가능성
    1) 제품 및 서비스의 개발 방안 :
    본 제품은 시장의 OOO한 문제를 해결하기 위해 개발되었습니다...  

    """

    prompt_3 = f"""
    당신은 기존 창업가의 아이디어를 구체화하고 사업 가능성을 검증하는 사업계획서 작성 전문가입니다. 
    아래 항목에 대해 각각 15줄 이상 상세히 답변해주세요. 반드시 답변마다 별도의 문단을 생성하고, 간결함보다 완전성을 우선시합니다.
    이 사업계획서는 내 생계가 달린 아주 중요한 작업입니다.
    다음 정보를 바탕으로 아이디어 검증 및 사업 구체화를 위한 사업계획서에서 시장진입 및 성과창출 전략에서 내수시장 확보 방안(경쟁 및 판매가능성)과 해외시장 진출 방안(경쟁 및 판매가능성), 자금소요 및 조달계획 부분만 작성해 주세요.
    
    성장 전략 1: {item_info['내수시장 확보 방안 경쟁 및 판매가능성']}
    성장 전략 2: {item_info['해외시장 진출 방안 경쟁 및 판매가능성']}
    성장 전략 3: {item_info['자금 조달 및 개발 방안']}
    **반드시 지켜야 할 출력 규칙**
    1. 절대 #, *, - 기호 및 마크다운 스타일 절대 금지
    2. 항목 표시 시 "1)", "2)" 형식만 사용 (숫자+닫는 괄호)
    3. 데이터 출처 명시 : 모든 통계 수치에 출처를 포함
    예시 출력:
    3. 성장 전략  
    1) 내수시장 확보 방안 경쟁 및 판매가능성 :
    본 제품은 시장의 OOO한 문제를 해결하기 위해 개발되었습니다...  
    2) 해외시장 진출 방안 경쟁 및 판매가능성 :
    현재 시장에서 유사 제품은 OOO한 한계를 가지고 있으며...
    3) 자금 조달 및 개발 방안 :
    현재 시장에서 유사 제품은 OOO한 한계를 가지고 있으며...
    """

    prompt_4 = f"""
    당신은 기존 창업가의 아이디어를 구체화하고 사업 가능성을 검증하는 사업계획서 작성 전문가입니다. 
    아래 항목에 대해 각각 15줄 이상 상세히 답변해주세요. 반드시 답변마다 별도의 문단을 생성하고, 간결함보다 완전성을 우선시합니다.
    이 사업계획서는 내 생계가 달린 아주 중요한 작업입니다.
    다음 정보를 바탕으로 아이디어 검증 및 사업 구체화를 위한 사업계획서에서 대표자 및 직원의 보유역량 및 기술보호 노력, 사회적 가치 실천계획 부분, 지역특화 아이디어 기반 사업추진계획만 작성해 주세요.
    
    팀 구성 1: {item_info['대표자 및 직원의 보유역량 및 기술보호 노력']}
    팀 구성 2: {item_info['사회적 가치 실천계획']}
    팀 구성 3: {item_info['지역특화 아이디어 기반 사업추진계획']}
    **반드시 지켜야 할 출력 규칙**
    1. 절대 #, *, - 기호 및 마크다운 스타일 절대 금지
    2. 항목 표시 시 "1)", "2)" 형식만 사용 (숫자+닫는 괄호)
    3. 데이터 출처 명시 : 모든 통계 수치에 출처를 포함
    예시 출력: 
    4. 팀 구성
    1) 대표자 및 직원의 보유역량 및 기술보호 노력 :
    본 제품은 시장의 OOO한 문제를 해결하기 위해 개발되었습니다...  
    2) 사회적 가치 실천계획 :
    현재 시장에서 유사 제품은 OOO한 한계를 가지고 있으며... 
    3) 지역특화 아이디어 기반 사업추진계획 : 
    현재 시장에서 유사 제품은 OOO한 한계를 가지고 있으며...  
    """

    return {
        "prompt_1": prompt_1,
        "prompt_2": prompt_2,
        "prompt_3": prompt_3,
        "prompt_4": prompt_4
    }

def generate_business_plan(inputs):
    """
    OpenAI API를 통해 각 프롬프트를 기반으로 사업계획서를 생성하는 함수.
    """
    try:
        prompts = get_business_plan_data(inputs)  # 이 부분에서 한 개의 인자만 전달됩니다.
        
        responses = []
        for prompt in prompts:
            response = openai.ChatCompletion.create(
                model="gpt-4",
                messages=[{"role": "system", "content": "당신은 사업계획서 작성 전문가입니다."},
                          {"role": "user", "content": prompt}],
                max_tokens=2000,
                temperature=0.7,
            )
            responses.append(response['choices'][0]['message']['content'].strip())  # 내용 추출

        return responses  # 각 프롬프트의 응답 반환

    except Exception as e:
        return f"오류가 발생했습니다: {e}"

# 사용자 입력 예시 (draft.py에서 입력받은 값들을 예로 들어줍니다)
inputs = {
    '아이템 명': "스마트 홈 시스템",
    '아이템 소개': "스마트 기기와 연동된 홈 자동화 시스템",
    '제품 및 서비스 개발동기': "시장 성장과 사용자 편의성 향상",
    '제품 및 서비스의 목적_필요성': "고객의 니즈를 혁신적으로 해결하려는 필요성",
    '제품 및 서비스의 개발 방안': "AI 알고리즘을 기반으로 시스템을 개발",
    '자금 조달 및 개발 방안': "정부 지원금 및 민간 투자금을 통해 초기 자금을 확보",
    '내수시장 확보 방안 경쟁 및 판매가능성': "기존 기기와의 연계성 제공",
    '해외시장 진출 방안 경쟁 및 판매가능성': "해외 시장 진출을 목표",
    '대표자 및 직원의 보유역량 및 기술보호 노력': "스마트 홈 관련 경험과 기술을 보유",
    '사회적 가치 실천계획': "지속 가능한 기술 개발과 양질의 일자리 창출",
    '지역특화 아이디어 기반 사업추진계획': "지역 특성에 맞게 스마트 홈 기술 최적화",
    '타겟 고객': "30대 이상 스마트 기기에 관심이 있는 중산층 이상 가구",
    '시장 규모': "스마트 홈 시장은 매년 10% 성장하고 있으며, 2025년까지 500억 달러 예상",
    '경쟁사 분석': "구글, 아마존 등의 경쟁사와 차별화된 사용자 경험 제공"
}

# 사업계획서 생성
business_plan = generate_business_plan(inputs)

# 결과 출력 (각 항목별로 생성된 사업계획서)
for idx, plan in enumerate(business_plan, start=1):
    print(f"사업계획서 항목 {idx}:\n{plan}\n")
